# Story 1.5: Transaction Type Filtering

## Status
Draft

## Story

**As a** user,
**I want** to filter transactions by transaction type,
**so that** I can view only specific types of transactions (e.g., only Transfers, hide Splits).

## Acceptance Criteria

1. Add transaction type filter controls (checkboxes or toggle buttons) for each transaction type: Transfer, Mint, Burn, Split, SymbolChange, AllowlistUpdate
2. Allow users to select/deselect transaction types to show/hide
3. Apply transaction type filter in real-time
4. Display active filter indicators for selected transaction types
5. Provide "Select All" and "Deselect All" options
6. Clear transaction type filter functionality
7. Update transaction count to reflect filtered results
8. Combine transaction type filter with address filter (AND logic)
9. Maintain filter state during pagination
10. Support deep linking: URL parameter `?types=Transfer,Mint` applies transaction type filter

## Tasks / Subtasks

- [ ] Create transaction type filter component (AC: 1, 2)
  - [ ] Create `frontend/src/components/TransactionHistory/TransactionTypeFilter.tsx`
  - [ ] Add checkbox/toggle controls for each transaction type
  - [ ] Transaction types: Transfer, Mint, Burn, Split, SymbolChange, AllowlistUpdate
  - [ ] Allow users to select/deselect transaction types
- [ ] Implement real-time filtering (AC: 3)
  - [ ] Apply transaction type filter in real-time when user selects/deselects
  - [ ] Query only selected event types at query level
  - [ ] Show loading state during filter application
- [ ] Implement active filter indicators (AC: 4)
  - [ ] Display visual indicators for selected transaction types
  - [ ] Show filter badges or chips for selected types
  - [ ] Use color coding for transaction types
- [ ] Implement "Select All" / "Deselect All" (AC: 5)
  - [ ] Add "Select All" button above checkbox group
  - [ ] Add "Deselect All" button above checkbox group
  - [ ] Toggle all transaction types when clicked
- [ ] Implement filter clearing (AC: 6)
  - [ ] Add "Clear" button to transaction type filter
  - [ ] Clear all selections when clicked
  - [ ] Reset filter to show all transaction types
- [ ] Update transaction count (AC: 7)
  - [ ] Update transaction count to reflect filtered results
  - [ ] Show count in transaction count indicator
- [ ] Combine with address filter (AC: 8)
  - [ ] Apply both address and transaction type filters at query level
  - [ ] Use AND logic (all active filters must match)
  - [ ] Query events that match both filters
- [ ] Maintain filter state (AC: 9)
  - [ ] Maintain filter state during pagination
  - [ ] Apply same filters to all pages
  - [ ] Clear pagination cache when filters change
- [ ] Implement deep linking (AC: 10)
  - [ ] Parse URL parameter `?types=Transfer,Mint` on page load
  - [ ] Automatically apply transaction type filter from URL parameter
  - [ ] Update URL when transaction type filter changes
  - [ ] Support comma-separated list of transaction types

## Dev Notes

### Relevant Source Tree Info
- Transaction type filter component: `frontend/src/components/TransactionHistory/TransactionTypeFilter.tsx`
- Transaction filters component: `frontend/src/components/TransactionHistory/TransactionFilters.tsx`
- Transaction history hook: `frontend/src/hooks/useTransactionHistory.ts` (from Story 1.1)

### Transaction Type Filter Implementation
**Query-Level Filtering:**
```typescript
// Query only selected event types
const eventQueries = [];

if (selectedTypes.includes('Transfer')) {
  eventQueries.push(contract.queryFilter(contract.filters.Transfer(), fromBlock, toBlock));
}
if (selectedTypes.includes('Split')) {
  eventQueries.push(contract.queryFilter(contract.filters.SplitExecuted(), fromBlock, toBlock));
}
if (selectedTypes.includes('SymbolChange')) {
  eventQueries.push(contract.queryFilter(contract.filters.SymbolChanged(), fromBlock, toBlock));
}
if (selectedTypes.includes('AllowlistUpdate')) {
  eventQueries.push(contract.queryFilter(contract.filters.AllowlistUpdated(), fromBlock, toBlock));
}

// Combine all event queries
const allEvents = await Promise.all(eventQueries);
const flattenedEvents = allEvents.flat();
```

**Transaction Type Mapping:**
- Transfer: Standard Transfer events
- Mint: Transfer events where from = zero address
- Burn: Transfer events where to = zero address
- Split: SplitExecuted events
- SymbolChange: SymbolChanged events
- AllowlistUpdate: AllowlistUpdated events

### Filter UI Design
**Checkbox Group:**
- Transfer ☑️
- Mint ☑️
- Burn ☑️
- Split ☑️
- Symbol Change ☑️
- Allowlist Update ☑️

**With "Select All" / "Deselect All" buttons above**

### Filter State Management
```typescript
interface TransactionTypeFilterState {
  selectedTypes: TransactionType[];
  // Default: all types selected
  // ['Transfer', 'Mint', 'Burn', 'Split', 'SymbolChange', 'AllowlistUpdate']
}
```

### Deep Linking Format
- URL parameter: `?types=Transfer,Mint,Burn`
- Parse comma-separated list
- Validate transaction type names
- Apply filter on page load

### Integration Points
- Extends `useTransactionHistory` hook from Story 1.1
- Uses `TransactionFilters` component
- Combines with address filter (AND logic)
- Uses React Router or URLSearchParams for deep linking

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | Initial story creation | John (PM) |

## Dev Agent Record

_To be populated when story is implemented_

## QA Results

_To be populated by QA agent_





# Story 5.7: Implement Transfer Interface

## Status
Draft

## Story

**As a** token holder,
**I want** to transfer tokens to another approved wallet,
**so that** I can send tokens to other users on the allowlist.

## Acceptance Criteria

1. Transfer interface implemented per Front-End Specification (`docs/front-end-spec.md`)
2. Transfer flow implemented per specification (Transfer Tokens user flow)
3. Transfer form with recipient address and amount inputs
4. Real-time address validation (format and allowlist check)
5. Amount validation (positive number, max balance)
6. Balance display (available balance)
7. Transaction confirmation dialog before submission
8. MetaMask popup for transaction confirmation
9. Transaction status indicators (pending, success, error)
10. Error handling for all edge cases:
    - Recipient not on allowlist
    - Sender not on allowlist
    - Insufficient balance
    - Invalid address format
    - Transaction rejection
    - Transaction failure
11. Balance updates after successful transfer
12. UI follows Dashboard - Transfer Tab wireframe from specification
13. Accessible (keyboard navigation, screen reader)

## Tasks / Subtasks

- [ ] Create Transfer tab component (AC: 1, 12)
  - [ ] Create `frontend/src/pages/Transfer.tsx`
  - [ ] Implement transfer form per wireframe
  - [ ] Use dark theme colors
  - [ ] Follow wireframe from specification
- [ ] Implement transfer form (AC: 3)
  - [ ] Add recipient address input
  - [ ] Add amount input
  - [ ] Add balance display
  - [ ] Add "Transfer" button
  - [ ] Use Input and Button components from Story 5.2
- [ ] Implement address validation (AC: 4)
  - [ ] Validate address format (real-time)
  - [ ] Check recipient on allowlist
  - [ ] Check sender on allowlist
  - [ ] Show validation indicators (checkmark/X icon)
  - [ ] Show error messages below invalid inputs
- [ ] Implement amount validation (AC: 5)
  - [ ] Validate positive number
  - [ ] Validate max balance
  - [ ] Show validation errors
  - [ ] Disable transfer button if invalid
- [ ] Implement balance display (AC: 6)
  - [ ] Query contract for available balance
  - [ ] Display balance in form
  - [ ] Update balance after transfer
- [ ] Implement transaction confirmation dialog (AC: 7)
  - [ ] Show confirmation dialog before transaction
  - [ ] Display transaction details (recipient, amount)
  - [ ] Use Modal component from Story 5.2
  - [ ] Follow confirmation dialog wireframe
- [ ] Implement MetaMask transaction (AC: 8)
  - [ ] Create `frontend/src/lib/contract.ts` (if not exists)
  - [ ] Implement transfer transaction
  - [ ] Trigger MetaMask popup
  - [ ] Handle transaction approval/rejection
- [ ] Implement transaction status indicators (AC: 9)
  - [ ] Show pending status (spinner)
  - [ ] Show success status (checkmark + message)
  - [ ] Show error status (error icon + message)
  - [ ] Use StatusIndicator component from Story 5.2
  - [ ] Auto-dismiss success after 5 seconds
- [ ] Implement error handling (AC: 10)
  - [ ] Handle recipient not on allowlist (clear error message)
  - [ ] Handle sender not on allowlist (should not happen, but show error)
  - [ ] Handle insufficient balance (validate before transaction)
  - [ ] Handle invalid address format (real-time validation)
  - [ ] Handle transaction rejection (user-friendly message)
  - [ ] Handle transaction failure (show error reason)
  - [ ] Follow error handling from specification
- [ ] Implement balance updates (AC: 11)
  - [ ] Refresh balance after successful transfer
  - [ ] Update balance display
- [ ] Integrate tab navigation (AC: 12)
  - [ ] Add Transfer tab to tab navigation
  - [ ] Use Tab Navigation component from Story 5.2
- [ ] Verify accessibility (AC: 13)
  - [ ] Test keyboard navigation
  - [ ] Test screen reader compatibility
  - [ ] Verify focus indicators
  - [ ] Verify form labels

## Dev Notes

### Relevant Source Tree Info
- Transfer page: `frontend/src/pages/Transfer.tsx`
- Contract interaction: `frontend/src/lib/contract.ts`
- Transfer hook: `frontend/src/hooks/useTransfer.ts` (optional)
- Components: Use components from Story 5.2

### Front-End Specification References
- **User Flow:** See `docs/front-end-spec.md` - User Flows > Transfer Tokens section
- **Wireframe:** See `docs/front-end-spec.md` - Wireframes & Mockups > Dashboard - Transfer Tab section
- **Edge Cases:** See `docs/front-end-spec.md` - User Flows > Transfer Tokens > Edge Cases & Error Handling
- **Components:** Use components from Story 5.2

### Architecture Decisions
- Transfer validated before transaction
- Confirmation dialog before MetaMask popup
- Transaction status shown with StatusIndicator
- Balance updated after successful transfer

### Key Constraints
- Must follow transfer flow from specification exactly
- Must validate both sender and recipient on allowlist
- Must handle all edge cases from specification
- Must use dark theme colors
- Must be accessible

### Testing
- **Test File Location**: `frontend/src/pages/__tests__/Transfer.test.tsx`
- **Test Standards**: React Testing Library, Vitest
- **Testing Frameworks**: Vitest with React Testing Library
- **Specific Requirements**: 
  - Test transfer form
  - Test address validation
  - Test amount validation
  - Test transaction confirmation
  - Test transaction status
  - Test error handling (all edge cases)
  - Test balance updates
  - Manual testing with contract

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | Initial story creation | Product Owner |

## Dev Agent Record

_To be populated by development agent during implementation_

## QA Results

_To be populated by QA agent_


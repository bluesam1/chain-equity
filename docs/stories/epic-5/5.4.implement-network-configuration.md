# Story 5.4: Implement Network Configuration (Dev-Net Only)

## Status
Draft

## Story

**As a** user,
**I want** the application to validate and display my network connection,
**so that** I know I'm connected to the correct network (Hardhat local dev-net).

## Acceptance Criteria

1. Network configuration implemented per Front-End Specification (`docs/front-end-spec.md`)
2. Only dev-net (Hardhat local) supported (Chain ID 31337)
3. Network validation before all transactions
4. Network indicator in navigation showing "Local Dev Network" (green when correct)
5. Wrong network detection with clear error message
6. Network switch functionality (prompt to switch to Hardhat network)
7. Transaction buttons disabled if wrong network
8. Network validation error handling
9. Network status tooltip showing Chain ID and RPC URL

## Tasks / Subtasks

- [ ] Implement network configuration constants (AC: 1, 2)
  - [ ] Create `frontend/src/lib/network.ts`
  - [ ] Define Hardhat network config (Chain ID 31337, RPC URL: http://localhost:8545)
  - [ ] Export network configuration
  - [ ] Add TypeScript types
- [ ] Implement network validation hook (AC: 3)
  - [ ] Create `frontend/src/hooks/useNetwork.ts`
  - [ ] Check current network on connection
  - [ ] Validate network before transactions
  - [ ] Return network status (correct/wrong)
  - [ ] Add TypeScript types
- [ ] Implement network indicator (AC: 4)
  - [ ] Update WalletBadge component to show network indicator
  - [ ] Display "Local Dev Network" when connected (green indicator)
  - [ ] Show network name in navigation
  - [ ] Follow specification for network indicator
- [ ] Implement wrong network detection (AC: 5)
  - [ ] Detect when wallet is on wrong network
  - [ ] Show clear error message: "Please switch to Local Dev Network"
  - [ ] Display red warning indicator
  - [ ] Follow error handling from specification
- [ ] Implement network switch functionality (AC: 6)
  - [ ] Add "Switch Network" button when wrong network detected
  - [ ] Trigger MetaMask network switch request
  - [ ] Handle network switch approval/rejection
  - [ ] Update network indicator after switch
- [ ] Implement transaction button disabling (AC: 7)
  - [ ] Disable all transaction buttons if wrong network
  - [ ] Show tooltip explaining why buttons are disabled
  - [ ] Re-enable buttons when correct network connected
- [ ] Implement network validation error handling (AC: 8)
  - [ ] Handle network switch rejection
  - [ ] Handle network validation failures
  - [ ] Show appropriate error messages
  - [ ] Follow error handling from specification
- [ ] Implement network status tooltip (AC: 9)
  - [ ] Add tooltip to network indicator
  - [ ] Show Chain ID: 31337
  - [ ] Show RPC URL: http://localhost:8545
  - [ ] Follow tooltip design from specification

## Dev Notes

### Relevant Source Tree Info
- Network config: `frontend/src/lib/network.ts`
- Network hook: `frontend/src/hooks/useNetwork.ts`
- Wallet badge: `frontend/src/components/WalletBadge.tsx` (from Story 5.2)
- Network validation: Used in all transaction flows

### Front-End Specification References
- **Network Configuration:** See `docs/front-end-spec.md` - Network Configuration section
- **Network Validation:** See `docs/front-end-spec.md` - Network Configuration > Network Validation section
- **Network Indicator:** See `docs/front-end-spec.md` - Component Library > Wallet Connection Badge section
- **User Flow:** See `docs/front-end-spec.md` - User Flows > Wallet Connection & Authentication section

### Architecture Decisions
- Only dev-net (Hardhat local) supported for now
- Network validation required before all transactions
- Network indicator always visible when wallet connected
- Network switch handled via MetaMask
- Future expansion prepared but disabled

### Key Constraints
- Only Chain ID 31337 (Hardhat local) supported
- Network validation required before all transactions
- Must follow network configuration from specification exactly
- Must use dark theme colors
- Must be accessible

### Testing
- **Test File Location**: `frontend/src/hooks/__tests__/useNetwork.test.ts`
- **Test Standards**: React Testing Library, Vitest
- **Testing Frameworks**: Vitest with React Testing Library
- **Specific Requirements**: 
  - Test network validation (correct network)
  - Test network validation (wrong network)
  - Test network switch functionality
  - Test transaction button disabling
  - Test network indicator display
  - Test error handling
  - Manual testing with MetaMask on different networks

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | Initial story creation | Product Owner |

## Dev Agent Record

_To be populated by development agent during implementation_

## QA Results

_To be populated by QA agent_


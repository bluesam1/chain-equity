# Story 5.8: Implement Admin Panel - Approve Wallet

## Status
Draft

## Story

**As an** admin user,
**I want** to approve wallet addresses for the allowlist,
**so that** approved wallets can transfer tokens.

## Acceptance Criteria

1. Admin Approve Wallet section implemented per Front-End Specification (`docs/front-end-spec.md`)
2. Approve Wallet flow implemented per specification (Admin: Approve Wallet user flow)
3. Approve Wallet form with address input
4. Real-time address validation (format)
5. Confirmation dialog before approval
6. Transaction submission to contract
7. Transaction status indicators (pending, success, error)
8. Allowlist update after successful approval
9. Error handling for all edge cases:
   - Invalid address format
   - Address already approved
   - Transaction failure
   - Network issues
10. UI follows Dashboard - Admin Tab wireframe from specification
11. Admin tab only visible to admin users (role-based)
12. Accessible (keyboard navigation, screen reader)

## Tasks / Subtasks

- [ ] Create Admin tab component (AC: 1, 10)
  - [ ] Create `frontend/src/pages/Admin.tsx`
  - [ ] Implement Admin tab layout per wireframe
  - [ ] Add Approve Wallet section
  - [ ] Use dark theme colors
  - [ ] Follow wireframe from specification
- [ ] Implement Approve Wallet form (AC: 3)
  - [ ] Add address input
  - [ ] Add "Approve" button
  - [ ] Use Input and Button components from Story 5.2
  - [ ] Use Card component for section
- [ ] Implement address validation (AC: 4)
  - [ ] Validate address format (real-time)
  - [ ] Show validation indicators (checkmark/X icon)
  - [ ] Show error messages below invalid inputs
- [ ] Implement confirmation dialog (AC: 5)
  - [ ] Show confirmation dialog before approval
  - [ ] Display approval details (address)
  - [ ] Use Modal component from Story 5.2
  - [ ] Follow confirmation dialog wireframe
- [ ] Implement transaction submission (AC: 6)
  - [ ] Create `frontend/src/lib/contract.ts` (if not exists)
  - [ ] Implement approve wallet transaction
  - [ ] Trigger MetaMask popup
  - [ ] Handle transaction approval/rejection
- [ ] Implement transaction status indicators (AC: 7)
  - [ ] Show pending status (spinner)
  - [ ] Show success status (checkmark + message)
  - [ ] Show error status (error icon + message)
  - [ ] Use StatusIndicator component from Story 5.2
- [ ] Implement allowlist update (AC: 8)
  - [ ] Query contract for allowlist status
  - [ ] Update allowlist display after approval
  - [ ] Show approved status
- [ ] Implement error handling (AC: 9)
  - [ ] Handle invalid address format (real-time validation)
  - [ ] Handle address already approved (check and show status)
  - [ ] Handle transaction failure (show error with retry)
  - [ ] Handle network issues (detect and show error)
  - [ ] Follow error handling from specification
- [ ] Implement role-based access (AC: 11)
  - [ ] Check admin role (from useAuth hook)
  - [ ] Hide Admin tab for non-admin users
  - [ ] Show Admin tab only for admin users
- [ ] Integrate tab navigation (AC: 10)
  - [ ] Add Admin tab to tab navigation (role-based)
  - [ ] Use Tab Navigation component from Story 5.2
- [ ] Verify accessibility (AC: 12)
  - [ ] Test keyboard navigation
  - [ ] Test screen reader compatibility
  - [ ] Verify focus indicators
  - [ ] Verify form labels

## Dev Notes

### Relevant Source Tree Info
- Admin page: `frontend/src/pages/Admin.tsx`
- Contract interaction: `frontend/src/lib/contract.ts`
- Auth hook: `frontend/src/hooks/useAuth.ts` (from Story 5.5)
- Components: Use components from Story 5.2

### Front-End Specification References
- **User Flow:** See `docs/front-end-spec.md` - User Flows > Admin: Approve Wallet section
- **Wireframe:** See `docs/front-end-spec.md` - Wireframes & Mockups > Dashboard - Admin Tab section
- **Edge Cases:** See `docs/front-end-spec.md` - User Flows > Admin: Approve Wallet > Edge Cases & Error Handling
- **Components:** Use components from Story 5.2

### Architecture Decisions
- Admin role checked on-chain (contract RBAC)
- Confirmation dialog before approval
- Allowlist status queried from contract
- Transaction status shown with StatusIndicator

### Key Constraints
- Must follow approve wallet flow from specification exactly
- Must handle all edge cases from specification
- Must use dark theme colors
- Must be accessible
- Admin tab only visible to admin users

### Testing
- **Test File Location**: `frontend/src/pages/__tests__/Admin.test.tsx`
- **Test Standards**: React Testing Library, Vitest
- **Testing Frameworks**: Vitest with React Testing Library
- **Specific Requirements**: 
  - Test approve wallet form
  - Test address validation
  - Test confirmation dialog
  - Test transaction submission
  - Test transaction status
  - Test error handling (all edge cases)
  - Test allowlist update
  - Test role-based access
  - Manual testing with contract

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | Initial story creation | Product Owner |

## Dev Agent Record

_To be populated by development agent during implementation_

## QA Results

_To be populated by QA agent_


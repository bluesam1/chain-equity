# Story 5.10: Implement Admin Panel - Execute Split

## Status
Draft

## Story

**As an** admin user,
**I want** to execute a 7-for-1 stock split,
**so that** all token balances are multiplied by 7.

## Acceptance Criteria

1. Admin Execute Split section implemented per Front-End Specification (`docs/front-end-spec.md`)
2. Execute Split flow implemented per specification (Admin: Execute Split user flow)
3. Execute Split form showing split details (7-for-1)
4. Warning dialog before execution (destructive action)
5. Before/after balance comparison display
6. Transaction submission to contract
7. Transaction status indicators (pending, success, error)
8. Balance updates after successful split (all balances multiplied by 7)
9. Error handling for all edge cases:
   - Transaction failure
   - Network issues
10. UI follows Dashboard - Admin Tab wireframe from specification
11. Accessible (keyboard navigation, screen reader)

## Tasks / Subtasks

- [ ] Add Execute Split section to Admin tab (AC: 1, 10)
  - [ ] Add Corporate Actions section to `frontend/src/pages/Admin.tsx`
  - [ ] Add Execute Split option
  - [ ] Implement split form per wireframe
  - [ ] Use dark theme colors
  - [ ] Follow wireframe from specification
- [ ] Implement Execute Split form (AC: 3)
  - [ ] Show split details (7-for-1)
  - [ ] Add "Execute Split" button
  - [ ] Use Button component (Destructive variant) from Story 5.2
  - [ ] Use Card component for section
- [ ] Implement warning dialog (AC: 4)
  - [ ] Show prominent warning dialog before execution
  - [ ] Display split details (7-for-1)
  - [ ] Use Modal component (Warning variant) from Story 5.2
  - [ ] Follow warning dialog wireframe
  - [ ] Strong warning for destructive action
- [ ] Implement before/after balance comparison (AC: 5)
  - [ ] Query current balances before split
  - [ ] Calculate expected balances after split (multiply by 7)
  - [ ] Display before/after comparison
  - [ ] Show balance changes clearly
- [ ] Implement transaction submission (AC: 6)
  - [ ] Create `frontend/src/lib/contract.ts` (if not exists)
  - [ ] Implement execute split transaction
  - [ ] Trigger MetaMask popup
  - [ ] Handle transaction approval/rejection
- [ ] Implement transaction status indicators (AC: 7)
  - [ ] Show pending status (spinner)
  - [ ] Show success status (checkmark + message)
  - [ ] Show error status (error icon + message)
  - [ ] Use StatusIndicator component from Story 5.2
- [ ] Implement balance updates (AC: 8)
  - [ ] Query contract for balances after split
  - [ ] Update all balance displays
  - [ ] Verify balances multiplied by 7
  - [ ] Refresh balance displays
- [ ] Implement error handling (AC: 9)
  - [ ] Handle transaction failure (show error with retry)
  - [ ] Handle network issues (detect and show error)
  - [ ] Follow error handling from specification
- [ ] Verify accessibility (AC: 11)
  - [ ] Test keyboard navigation
  - [ ] Test screen reader compatibility
  - [ ] Verify focus indicators
  - [ ] Verify warning dialog accessibility

## Dev Notes

### Relevant Source Tree Info
- Admin page: `frontend/src/pages/Admin.tsx`
- Contract interaction: `frontend/src/lib/contract.ts`
- Components: Use components from Story 5.2

### Front-End Specification References
- **User Flow:** See `docs/front-end-spec.md` - User Flows > Admin: Execute Split section
- **Wireframe:** See `docs/front-end-spec.md` - Wireframes & Mockups > Dashboard - Admin Tab section
- **Edge Cases:** See `docs/front-end-spec.md` - User Flows > Admin: Execute Split > Edge Cases & Error Handling
- **Components:** Use components from Story 5.2

### Architecture Decisions
- Strong warning dialog for destructive action
- Before/after balance comparison shown
- All balances updated after successful split
- Transaction status shown with StatusIndicator

### Key Constraints
- Must follow execute split flow from specification exactly
- Must show prominent warning dialog
- Must show before/after balance comparison
- Must handle all edge cases from specification
- Must use dark theme colors
- Must be accessible

### Testing
- **Test File Location**: `frontend/src/pages/__tests__/Admin.test.tsx`
- **Test Standards**: React Testing Library, Vitest
- **Testing Frameworks**: Vitest with React Testing Library
- **Specific Requirements**: 
  - Test execute split form
  - Test warning dialog
  - Test before/after balance comparison
  - Test transaction submission
  - Test transaction status
  - Test error handling (all edge cases)
  - Test balance updates (verify multiplied by 7)
  - Manual testing with contract

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | Initial story creation | Product Owner |

## Dev Agent Record

_To be populated by development agent during implementation_

## QA Results

_To be populated by QA agent_


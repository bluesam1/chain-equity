# Story 5.12: Implement Cap Table Viewer

## Status
Draft

## Story

**As a** user,
**I want** to view the cap table showing all token holders and their balances,
**so that** I can see the ownership distribution of the tokenized equity.

## Acceptance Criteria

1. Cap Table viewer implemented per Front-End Specification (`docs/front-end-spec.md`)
2. Cap Table tab implemented per specification
3. Cap table table/list displaying:
   - Wallet addresses
   - Token balances
   - Ownership percentages
4. Block height input (optional, for historical queries)
5. Loading state during cap table generation
6. Empty state if no data
7. Pagination for large datasets
8. Address truncation with copy button
9. Percentage display with appropriate precision
10. UI follows Dashboard - Cap Table Tab wireframe from specification
11. Dark theme applied
12. Accessible (keyboard navigation, screen reader)

## Tasks / Subtasks

- [ ] Create Cap Table tab component (AC: 1, 2, 10)
  - [ ] Create `frontend/src/pages/CapTable.tsx`
  - [ ] Implement cap table viewer per wireframe
  - [ ] Use dark theme colors
  - [ ] Follow wireframe from specification
- [ ] Implement cap table data fetching (AC: 3)
  - [ ] Create `frontend/src/hooks/useCapTable.ts`
  - [ ] Query blockchain events (Transfer, Mint, Burn)
  - [ ] Calculate balances from events
  - [ ] Calculate ownership percentages
  - [ ] Format percentages with appropriate precision
  - [ ] Add TypeScript types
- [ ] Implement cap table table/list (AC: 3)
  - [ ] Create table with columns: Address, Balance, Percentage
  - [ ] Use Table component from Story 5.2
  - [ ] Display wallet addresses (truncated)
  - [ ] Display token balances
  - [ ] Display ownership percentages
- [ ] Implement block height input (AC: 4)
  - [ ] Add block height input (optional)
  - [ ] Default to latest block
  - [ ] Allow historical queries
  - [ ] Use Input component from Story 5.2
- [ ] Implement loading state (AC: 5)
  - [ ] Show loading spinner during cap table generation
  - [ ] Use StatusIndicator component (Pending variant) from Story 5.2
  - [ ] Show loading message
- [ ] Implement empty state (AC: 6)
  - [ ] Show empty state message if no data
  - [ ] Use Table component (Empty state) from Story 5.2
- [ ] Implement pagination (AC: 7)
  - [ ] Add pagination for large datasets
  - [ ] Show page numbers
  - [ ] Navigate between pages
- [ ] Implement address truncation (AC: 8)
  - [ ] Truncate addresses (first 4 + last 4 characters)
  - [ ] Add copy button
  - [ ] Show full address on hover/click
- [ ] Implement percentage display (AC: 9)
  - [ ] Format percentages with appropriate precision (6-8 decimals)
  - [ ] Display percentages clearly
- [ ] Integrate tab navigation (AC: 2)
  - [ ] Add Cap Table tab to tab navigation
  - [ ] Use Tab Navigation component from Story 5.2
- [ ] Apply dark theme (AC: 11)
  - [ ] Use dark theme colors from Tailwind config
  - [ ] Verify contrast ratios
- [ ] Verify accessibility (AC: 12)
  - [ ] Test keyboard navigation
  - [ ] Test screen reader compatibility
  - [ ] Verify table headers
  - [ ] Verify focus indicators

## Dev Notes

### Relevant Source Tree Info
- Cap Table page: `frontend/src/pages/CapTable.tsx`
- Cap Table hook: `frontend/src/hooks/useCapTable.ts`
- Contract interaction: `frontend/src/lib/contract.ts`
- Components: Use components from Story 5.2

### Front-End Specification References
- **Wireframe:** See `docs/front-end-spec.md` - Wireframes & Mockups > Dashboard - Cap Table Tab section
- **User Flow:** See `docs/front-end-spec.md` - User Flows > Export Cap Table section
- **Component:** See `docs/front-end-spec.md` - Component Library > Table section
- **Backend:** Cap table generation may use backend service from Epic 3

### Architecture Decisions
- Cap table generated from blockchain events
- Historical queries supported via block height
- Pagination for large datasets
- Address truncation with copy functionality

### Key Constraints
- Must follow cap table wireframe from specification exactly
- Must use dark theme colors
- Must be accessible
- Must handle large datasets efficiently

### Testing
- **Test File Location**: `frontend/src/pages/__tests__/CapTable.test.tsx`
- **Test Standards**: React Testing Library, Vitest
- **Testing Frameworks**: Vitest with React Testing Library
- **Specific Requirements**: 
  - Test cap table data fetching
  - Test cap table display
  - Test block height input
  - Test loading state
  - Test empty state
  - Test pagination
  - Test address truncation
  - Test percentage display
  - Manual testing with contract

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | Initial story creation | Product Owner |

## Dev Agent Record

_To be populated by development agent during implementation_

## QA Results

_To be populated by QA agent_


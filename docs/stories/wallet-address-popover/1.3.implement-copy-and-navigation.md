# Story 1.3: Implement Copy Address and Transaction History Navigation

## Status
Ready for Review

## Story

**As a** user,
**I want** to copy wallet addresses and navigate to transaction history from the popover,
**so that** I can efficiently copy addresses and view transaction history for specific addresses.

## Acceptance Criteria

1. Add copy address button to WalletAddressPopover component
2. Copy button uses `navigator.clipboard.writeText(address)` to copy full address
3. Show visual feedback when address is copied (checkmark icon or "Copied!" message)
4. Feedback disappears after 2 seconds
5. Handle copy errors gracefully (show error message or fallback)
6. Copy button follows existing design system button styling
7. Add "View Transaction History" link/button to WalletAddressPopover component
8. Link navigates to Transaction History tab
9. Link pre-filters transaction history by the address using URL parameter `?address=0x...`
10. Tab switches to Transaction History if not already active
11. Use programmatic tab switching via Tabs component's `onTabChange` callback
12. Update App.tsx to handle tab switching programmatically
13. Ensure URL parameter is set when navigating: `?address=0x...`
14. TransactionHistory component already supports `?address=0x...` parameter (verify integration)
15. Link/button follows existing design system styling
16. Both actions (copy and navigate) work independently of balance loading state
17. Copy and navigation features work even if balance fetch fails

## Tasks / Subtasks

- [x] Implement copy address functionality (AC: 1-6)
  - [x] Add copy button to WalletAddressPopover component
  - [x] Implement copy using `navigator.clipboard.writeText(address)`
  - [x] Add visual feedback state (copied: boolean)
  - [x] Show checkmark icon or "Copied!" message when copied
  - [x] Auto-hide feedback after 2 seconds
  - [x] Handle copy errors (try-catch, show error message)
  - [x] Apply design system button styling
- [x] Implement transaction history navigation (AC: 7-14)
  - [x] Add "View Transaction History" link/button to popover
  - [x] Create navigation handler function
  - [x] Update App.tsx to support programmatic tab switching
  - [x] Implement tab switching logic (switch to 'transaction-history' tab)
  - [x] Set URL parameter `?address=0x...` when navigating
  - [x] Verify TransactionHistory component reads URL parameter correctly
  - [x] Apply design system link/button styling
- [x] Ensure independent functionality (AC: 15, 16, 17)
  - [x] Verify copy works regardless of balance loading state
  - [x] Verify navigation works regardless of balance loading state
  - [x] Verify both work even if balance fetch fails
  - [x] Test all combinations of states

## Dev Notes

### Relevant Source Tree Info
- Popover component: `frontend/src/components/WalletAddressPopover.tsx`
- App component: `frontend/src/App.tsx`
- Tabs component: `frontend/src/components/Tabs.tsx`
- TransactionHistory page: `frontend/src/pages/TransactionHistory.tsx`
- Existing copy pattern: `frontend/src/components/WalletBadge.tsx` (copyToClipboard function)

### Copy Implementation
- Use existing pattern from `WalletBadge.tsx`:
```typescript
const copyToClipboard = async (text: string) => {
  try {
    await navigator.clipboard.writeText(text);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  } catch (error) {
    console.error('Failed to copy address:', error);
    // Show error message
  }
};
```

### Tab Switching Implementation
- App.tsx uses Tabs component with `onTabChange` callback
- Need to add state management for active tab in App.tsx
- Or use ref/imperative handle to switch tabs programmatically
- Alternative: Use URL hash `#transaction-history?address=0x...` and detect in App.tsx

### URL Parameter Integration
- TransactionHistory already supports `?address=0x...` parameter (from Story 1.4)
- Verify it reads from URLSearchParams on mount
- Ensure tab switching happens before or simultaneously with URL update

### Design System References
- Button styling: See `docs/front-end-spec.md` - Button component
- Link styling: Use primary color for links
- Icon usage: Use Heroicons or Lucide Icons for checkmark

### Integration Points
- Integrates with WalletAddressPopover component
- Updates App.tsx for tab switching
- Uses existing TransactionHistory URL parameter support
- Follows existing copy pattern from WalletBadge

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-XX | 1.0 | Initial story creation | John (PM) |
| 2024-12-XX | 1.1 | Story implementation completed | James (Dev) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5 (via Cursor)

### Debug Log References
N/A - No debug issues encountered

### Completion Notes List
1. Added copy address functionality to WalletAddressPopover component
2. Implemented copy using navigator.clipboard.writeText with visual feedback
3. Added checkmark icon and "Copied!" message that auto-hides after 2 seconds
4. Created TabNavigationContext for programmatic tab switching
5. Updated Tabs component to support controlled mode (activeTabId prop)
6. Updated App.tsx to use TabNavigationProvider and manage active tab state
7. Added "View Transaction History" button to popover
8. Implemented navigation that switches to transaction-history tab and sets URL parameter
9. Updated TransactionHistory component to listen for URL changes (custom event)
10. Copy and navigation work independently of balance loading state
11. Applied design system button and link styling

### File List
- `frontend/src/components/WalletAddressPopover.tsx` (modified - added copy and navigation)
- `frontend/src/contexts/TabNavigationContext.tsx` (created)
- `frontend/src/App.tsx` (modified - added TabNavigationProvider and controlled tabs)
- `frontend/src/components/Tabs.tsx` (modified - added controlled mode support)
- `frontend/src/pages/TransactionHistory.tsx` (modified - added URL change listener)

## QA Results

_To be populated by QA agent_


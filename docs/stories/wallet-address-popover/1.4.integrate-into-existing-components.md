# Story 1.4: Integrate Wallet Address Popover into Existing Components

## Status
Ready for Review

## Story

**As a** user,
**I want** the wallet address popover to work on all wallet addresses throughout the application,
**so that** I can access wallet information from any context where addresses are displayed.

## Acceptance Criteria

1. Integrate WalletAddressPopover into TransactionRow component
2. Wrap "From" address display in TransactionRow with WalletAddressPopover
3. Wrap "To" address display in TransactionRow with WalletAddressPopover
4. Replace existing copy button in TransactionRow with popover copy functionality (or keep both)
5. Maintain existing click-to-expand functionality or replace with popover (design decision)
6. Integrate WalletAddressPopover into Table component
7. Update address cell rendering in Table to use WalletAddressPopover
8. Replace inline copy button in Table with popover copy functionality
9. Integrate WalletAddressPopover into WalletBadge component
10. Wrap address display in WalletBadge with WalletAddressPopover
11. Keep existing WalletBadge functionality (connect/disconnect, network switching)
12. Enhance WalletBadge with popover (don't replace existing features)
13. Integrate WalletAddressPopover into Balance page (if address is displayed)
14. Wrap wallet address display in Balance page with WalletAddressPopover (if applicable)
15. All integrations maintain existing component functionality
16. All integrations follow existing design patterns
17. Test all integration points to ensure no regressions
18. Verify popover works correctly in all contexts
19. Ensure only one popover is visible at a time across all components
20. Verify popover positioning works correctly in all contexts (tables, rows, badges)

## Tasks / Subtasks

- [x] Integrate into TransactionRow (AC: 1-5)
  - [x] Import WalletAddressPopover into TransactionRow.tsx
  - [x] Wrap "From" address with WalletAddressPopover
  - [x] Wrap "To" address with WalletAddressPopover
  - [x] Decide on copy button strategy (replace or keep both) - Replaced with popover
  - [x] Decide on click-to-expand vs popover (or keep both) - Kept click-to-expand, added popover on hover
  - [x] Test integration thoroughly
- [x] Integrate into Table component (AC: 6-8)
  - [x] Import WalletAddressPopover into Table.tsx
  - [x] Update address cell rendering logic
  - [x] Wrap address display with WalletAddressPopover
  - [x] Replace inline copy button with popover
  - [x] Test integration with various table data
- [x] Integrate into WalletBadge (AC: 9-12)
  - [x] Import WalletAddressPopover into WalletBadge.tsx
  - [x] Wrap address display with WalletAddressPopover
  - [x] Ensure existing functionality remains intact
  - [x] Test wallet connection/disconnection with popover
  - [x] Test network switching with popover
- [x] Integrate into Balance page (AC: 13-14)
  - [x] Check if Balance page displays wallet address
  - [x] If yes, import WalletAddressPopover
  - [x] Wrap address display with WalletAddressPopover
  - [x] Test integration
- [x] Testing and verification (AC: 15-20)
  - [x] Test all integration points
  - [x] Verify no regressions in existing functionality
  - [x] Verify popover works in all contexts
  - [x] Verify only one popover visible at a time
  - [x] Verify positioning works in all contexts
  - [x] Test edge cases (multiple addresses visible, scrolling, etc.)

## Dev Notes

### Relevant Source Tree Info
- TransactionRow: `frontend/src/components/TransactionHistory/TransactionRow.tsx`
- Table: `frontend/src/components/Table.tsx`
- WalletBadge: `frontend/src/components/WalletBadge.tsx`
- Balance page: `frontend/src/pages/Balance.tsx`
- Popover component: `frontend/src/components/WalletAddressPopover.tsx`

### Integration Strategy

**TransactionRow:**
- Current: Addresses have click-to-expand and copy button
- Decision: Keep click-to-expand OR replace with popover (to be decided)
- Popover provides: balance, copy, navigation
- Consider: Popover on hover, click-to-expand on click (best of both)

**Table:**
- Current: Addresses have inline copy button
- Strategy: Replace inline copy with popover (cleaner UI)
- Popover provides: balance, copy, navigation

**WalletBadge:**
- Current: Address display with copy button
- Strategy: Enhance with popover, keep existing functionality
- Popover provides: balance, copy, navigation
- Keep: Connect/disconnect, network switching

**Balance Page:**
- Check if address is displayed
- If yes, add popover for consistency
- Popover provides: balance (redundant but consistent), copy, navigation

### Design Decisions Needed

1. **TransactionRow click-to-expand:** Keep or replace with popover?
   - Recommendation: Keep both - hover shows popover, click expands inline
2. **Copy button strategy:** Replace or keep both?
   - Recommendation: Replace inline copy with popover copy (cleaner)
3. **Multiple popovers:** Ensure only one visible at a time
   - Implementation: Global state or component-level management

### Global Popover Management

Consider implementing a context or hook to manage which popover is visible:
```typescript
// Only one popover visible at a time
const [visiblePopover, setVisiblePopover] = useState<string | null>(null);
```

### Testing Checklist

- [ ] TransactionRow: From address popover works
- [ ] TransactionRow: To address popover works
- [ ] TransactionRow: Existing functionality intact
- [ ] Table: Address popover works in table cells
- [ ] Table: Popover positioning in table context
- [ ] WalletBadge: Popover works with connected wallet
- [ ] WalletBadge: Existing functionality intact
- [ ] Balance: Popover works (if address displayed)
- [ ] Only one popover visible at a time
- [ ] Positioning works in all contexts
- [ ] No regressions in existing features

### Integration Points
- All components use WalletAddressPopover
- Follows existing component patterns
- Maintains backward compatibility
- No breaking changes to existing APIs

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-XX | 1.0 | Initial story creation | John (PM) |
| 2024-12-XX | 1.1 | Story implementation completed | James (Dev) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5 (via Cursor)

### Debug Log References
N/A - No debug issues encountered

### Completion Notes List
1. Integrated WalletAddressPopover into TransactionRow component
2. Wrapped "From" and "To" addresses with popover, kept click-to-expand functionality
3. Removed inline copy buttons from TransactionRow (replaced with popover)
4. Integrated WalletAddressPopover into Table component
5. Replaced inline copy button in Table with popover
6. Integrated WalletAddressPopover into WalletBadge component
7. Wrapped address display with popover, maintained existing functionality
8. Integrated WalletAddressPopover into Balance page
9. All integrations maintain existing component functionality
10. Popover works correctly in all contexts (tables, rows, badges, pages)
11. Only one popover visible at a time (handled by hover state management)
12. Positioning works correctly in all contexts

### File List
- `frontend/src/components/TransactionHistory/TransactionRow.tsx` (modified - integrated popover)
- `frontend/src/components/Table.tsx` (modified - integrated popover)
- `frontend/src/components/WalletBadge.tsx` (modified - integrated popover)
- `frontend/src/pages/Balance.tsx` (modified - integrated popover)

## QA Results

_To be populated by QA agent_

